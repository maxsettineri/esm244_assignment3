---
title: "Task 2"
author: "Max Settineri"
date: "2023-02-28"
output: 
  html_document:
    code_folding: hide
    toc: yes
---

## Introduction

**Data Citation:** Citation: Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. Environmental Data Initiative. https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174.

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(janitor)
library(here)
library(NbClust)
library(cluster)
library(factoextra)
library(dendextend)
library(ggdendro)
```

## Data wrangling

```{r}
## reading in the data
streams <- read_csv(here('data/sbc_lter_registered_stream_chemistry.csv')) %>% 
  clean_names() %>% 
  na_if(-999) %>% ## changing -999 values to NA
  select(-tss_mgper_liter, -tpp_u_m, -tpn_u_m, -tpc_u_m, -timestamp_local) %>%  ## removing columns with more than 50% NA values
  group_by(site_code) %>% ## grouping by site
  summarize('Ammonium' = mean(nh4_u_m, na.rm = TRUE), ## renaming columns and using na.rm to remove rows with NA values
    'Nitrate' = mean(no3_u_m, na.rm = TRUE),
    'Phosphorous' = mean(po4_u_m, na.rm = TRUE),
    'Dissolved nitrogen' = mean(tdn_u_m, na.rm = TRUE),
    'Dissolved phosphorous' = mean(tdp_u_m, na.rm = TRUE),
    'Specific conductivity' = mean(spec_cond_u_spercm, na.rm = TRUE)) 
```

## Agglomerative hierarchical clustering

```{r}
## creating scaled version of the data for use in hierarchical clustering
streams_scaled <- streams %>% 
  select(-site_code) %>% ## removing site code since it's non numerical
  scale() ## scaling the data

## using site code as row names
rownames(streams_scaled) <- streams$site_code 

## creating matrix of euclidean distances
streams_dist <- dist(streams_scaled, method = 'euclidean')

## hierarchical clustering (complete linkage)
streams_hc_complete <- hclust(streams_dist, method = 'complete')

## plotting dendrogram to observe clusters
# plot(streams_hc_complete, cex = .6, hang = -1)

## cut tree into three clusters
# streams_cut_hc <- cutree(streams_hc_complete, 3)
# table(streams_cut_hc, streams_hc_complete)

## maing a finalized dendrogram with ggdendro
ggdendrogram(streams_hc_complete) +
  theme_minimal() +
  labs(x = 'Stream Site', y = 'Euclidian Distance')

```

**Figure 1:** Depicts a dendrogram that shows relationships in water chemistry by stream site. The cluster dendrogram was produced using complete linkages. 

## Summary

- Figure 1 displays two main distinct clusters, with stream site `DV01` being isolated into its own cluster third
- `BC02`, `AT07`, `AB00`, `MC00`, `SP02`, `GV01` and `MC06` form a distinct second cluster
- Stream sites `TO02`, `RG01`, `ON02`, `HO00` and `RS02` form a third cluster
- 